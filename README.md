# ICST-2022-submission: JavaScript Instrumentation for Search-Based Software Testing: A Study with RESTful APIs

In this package, we provide necessary information for replicating the experiment in the paper that includes 

- [EvoMaster](EvoMaster): tools described in the paper with our js instrumentation and test writer.
- [jar](jar): runnable jar for EvoMaster.
- [EMB-js](EMB-js): five NodeJS case studies employed for the experiment.
- [build.py](build.py): a python script to build tools and all five case studies.
- [run.sh](run.sh) and [runBB.sh](runBB.sh): examples to run our tool against __ncs-js__ case study.


### Implementation clarification

To enable SBST for NodeJs application, we implemented
- javascript instrumentation as Babel plugin, and the source code is located`Evomaster\client-js\evomaster-client-js`[here](EvoMaster/client-js/evomaster-client-js).
- driver to communicate with EvoMaster and SUT.
- JavaScript test writer for producing jest tests.

## Quick build and run


**Step 1.** In this repo, we provide a python script to build tools and all five case studies.

Go to the root, run 
> `python3 build.py`

After the build is finished, for each of case studies, there would be a new `build` folder which contains instrumented code.
For EvoMaster, its `jar` file would be found under `EvoMaster/core/target`.

**Step 2.** To try our tool with __ncs-js__ case study, run bash

> `./run.sh`

The script includes two settings i.e., JS-MIO and JS-Random as described in the paper.
After the execution is done, you will see a folder named `example` which contains
- `EM_JS_MIO_Test.js` : a test generated by JS-MIO with fitness evaluation on 100,000 HTTP calls
- `EM_JS_Random_Test.js`: a test generated by JS-Random with fitness evaluation on 100,000 HTTP calls
- `statistics_ncs_js.csv`: statistics info (like covered targets, covered lines, covered branches) for two settings
- `snapshot_ncs_js.csv`: snapshot of statistics collected (at e.g., every 5% budget used) during the search for two settings

**Step 3.** In addition, we also provide an example for presenting coverage collection with `c8` for a whole process.
The example is with BB_ft setting against __ncs-js__ case study.
**NOTE** Before running the example, please install `c8`, see https://github.com/bcoe/c8. Then start the example with
> `./runBB.sh`

After the execution is done, you will see

In `example` folder
- `EM_BB_ft_Test.js` is generated for a test generated by BB_ft setting with 3.97minutes time budget
- `statistics_ncs_js.csv`: there are additional info for BB_ft setting
- `snapshot_ncs_js.csv`: there are additional info for BB_ft setting

In `EMB-js/rest/ncs`, there would be a new folder named `coverage` which contains 
- `coverage-summary.json`: a coverage report with json format.

## Build and run step by step

**Build JavaScript Instrumentation**

Go to `Evomaster\client-js\evomaster-client-js`, run
- step 1`npm install`
- step 2 `npm run build`

**Build EvoMaster**

Go to `Evomaster`, run
- step 3 `mvn clean install -DskipTests`

**Instrument SUT**

Go to a sut, e.g., `EMB-js\rest\ncs-js`, run
- step 4 `npm install`
- step 5 `npm run build`

then under the sut, you will see a new folder named `build` which contains instrumented code,
e.g., `EMB-js\rest\ncs-js\build`

**Start EM Driver**

Go to the sut, e.g., `EMB-js\rest\ncs-js`
- step 6 `npm run em`

**Start EvoMaster**

- step 7 `java -jar evomaster.jar `

In this experiment, we use configurations like, 
- `--algorithm=MIO` for algorithm setting;
- `--outputFormat=JS_JEST` for output format setting; 
- `--stoppingCriterion=FITNESS_EVALUATIONS --maxActionEvaluations=100000` for fitness budget setting;
- `--maxTime` for time budget setting;
- `--blackbox` for white-box and black-box setting.
- `--bbSwaggerUrl` for accessing schema of REST in black-box setting.
